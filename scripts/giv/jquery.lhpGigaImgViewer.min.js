// Giga Image Viewer v1.6 - jQuery image viewer plugin - converting <div> element to an animated image viewer
// (c) 2012 lhp - http://codecanyon.net/user/lhp

(function(g){var d,i,f;i={dragSmooth:8,previewImgFilename:"preview.jpg",mapThumbFilename:"thumb.jpg",mainImgExt:"jpg"};f={viewportWidth:"100%",viewportHeight:"100%",fitToViewportShortSide:false,contentSizeOver100:false,startScale:1,startX:0,startY:0,animTime:500,draggInertia:10,imgDir:"",mainImgWidth:256,mainImgHeight:256,intNavEnable:true,intNavPos:"T",intNavAutoHide:false,intNavMoveDownBtt:true,intNavMoveUpBtt:true,intNavMoveRightBtt:true,intNavMoveLeftBtt:true,intNavZoomBtt:true,intNavUnzoomBtt:true,intNavFitToViewportBtt:true,intNavFullSizeBtt:true,intNavBttSizeRation:1,mapEnable:true,mapPos:"BL",popupShowAction:"rollover",testMode:false};d={init:function(n,m){return this.each(function(){var q=g(this),p=q.data("lhpGIV"),o={};g.extend(o,f,n);g.extend(o,i);if(!p){if(o.draggInertia<0){o.draggInertia=0}o.animTime=parseInt(o.animTime);if(o.animTime<0){o.animTime=0}q.data("lhpGIV",{});q.data("lhpGIV").lc=new e(o,q,m)}})},setPosition:function(m,p,o,n){return this.each(function(){var r=g(this),q=r.data("lhpGIV");if(q){r.data("lhpGIV").lc.setProperties(m,p,o,n)}})},moveUp:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.beginDirectMove("U")}})},moveDown:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.beginDirectMove("D")}})},moveLeft:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.beginDirectMove("L")}})},moveRight:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.beginDirectMove("R")}})},moveStop:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.stopDirectMoving()}})},zoom:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.beginZooming("Z")}})},unzoom:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.beginZooming("U")}})},zoomStop:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.stopZooming()}})},fitToViewport:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.setProperties(null,null,0)}})},fullSize:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.setProperties(null,null,1)}})},adaptsToContainer:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.adaptsToContainer()}})},getCurrentState:function(){var o=g(this),n=o.data("lhpGIV"),m={};if(n){m=o.data("lhpGIV").lc.getCurrentState()}return m},destroy:function(){return this.each(function(){var n=g(this),m=n.data("lhpGIV");if(m){n.data("lhpGIV").lc.destroy();n.removeData("lhpGIV")}})}};g.fn.lhpGigaImgViewer=function(m){if(d[m]){return d[m].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof m==="object"||!m){return d.init.apply(this,arguments)}else{g.error("Method "+m+" does not exist on jQuery.lhpGigaImgViewer");return null}}};var e=function(n,o,m){this.isTouchDev=this.isTouchDevice();this.sett=n;this.$mainHolder=o;this.lastMousePageCoor={};this.lastDrag={};this.contentFullSize={};this.$givHol=null;this.$contentHol=null;this.$content=null;this.$preloadHol=null;this.$blackScreen=null;this.$infoBox=null;this.movingIntreval=null;this.movingDirectIntreval=null;this.navAutohideInterval=null;this.speedX=this.speedY=null;this.targetX=this.targetY=null;this.allow={allowDown:false,allowUp:false,allowLeft:false,allowRight:false,allowZoom:false,allowUnzoom:false};this.isScaled=false;this.sm=new l();this.nav=null;this.map=null;this.markersContainer=m;this.markers=null;this.tiles={};this.tileSize=256;this.contentFullSize={w:this.sett.mainImgWidth,h:this.sett.mainImgHeight};this.createHolders();this.contentLoader=new h(this.sett.imgDir+this.sett.previewImgFilename,this.$contentHol,function(p){return function(q){p.imgContentStart(q)}}(this));this.contentLoader.loadStart()};e.prototype.isTouchDevice=function(){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){if(navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i)==null){return false}}return(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch)};e.prototype.createHolders=function(){this.$givHol=g("<div />").addClass("lhp_giv_holder").css({position:"relative",overflow:"hidden",width:this.sett.viewportWidth,height:this.sett.viewportHeight});this.$preloadHol=g("<div />").addClass("lhp_giv_preload_holder");this.$contentHol=g("<div />").addClass("lhp_giv_content_holder").css({position:"absolute",width:this.contentFullSize.w,height:this.contentFullSize.h});this.$blackScreen=g("<div />").addClass("lhp_giv_blackScreen").css({position:"absolute","z-index":"9999",width:"100%",height:"100%",background:"#ffffff"});this.$givHol.append(this.$preloadHol);this.$givHol.append(this.$blackScreen);this.$givHol.append(this.$contentHol);this.$mainHolder.append(this.$givHol);if(this.sett.testMode){this.$infoBox=g("<div />").addClass("lhp_giv_infoBox_holder");this.$givHol.append(this.$infoBox)}};e.prototype.imgContentStart=function(m){this.$content=m;this.start();this.$blackScreen.animate({opacity:0},{duration:500,complete:function(){g(this).remove()}})};e.prototype.start=function(){if(this.sett.intNavEnable){this.nav=new a(this.sett,this.$mainHolder,this.isTouchDev);this.$givHol.prepend(this.nav.ini())}if(this.sett.mapEnable){this.map=new c(this.sett,this.$mainHolder,this.$content,this.isTouchDev);this.map.ini(this.$givHol)}this.$content.addClass("lhp_giv_content").css({"float":"left",width:this.contentFullSize.w,height:this.contentFullSize.h});this.markers=new b(this.$mainHolder,this.$contentHol,this.markersContainer,this.isTouchDev,this.sett.popupShowAction,this.sett.startScale);this.markers.ini();if(this.isTouchDev){this.$contentHol.bind("touchstart.lhpGIV",{_this:this},this.mousedownHandler)}else{this.$contentHol.bind("mouseenter.lhpGIV",{_this:this},this.mouseenterHandler);this.$contentHol.bind("mousedown.lhpGIV",{_this:this},this.mousedownHandler);this.$contentHol.bind("mouseup.lhpGIV",{_this:this},this.mouseupHandler);this.$contentHol.bind("mouseleave.lhpGIV",{_this:this},this.mouseupHandler);this.$contentHol.bind("mousewheel.lhpGIV",{_this:this},this.mousewheelHandler);if(this.sett.testMode){this.$contentHol.bind("mousemove.lhpGIV",{_this:this},this.showCurrentCoor)}}this.setProperties(this.sett.startX,this.sett.startY,this.sett.startScale,true);this.addTiles()};e.prototype.destroy=function(){this.contentLoader.dispose();this.animStop();this.stopMoving();this.stopDirectMoving();if(this.markers){this.markers.destroy()}if(this.nav){this.nav.destroy()}if(this.map){this.map.destroy()}this.$mainHolder.unbind(".lhpGIV");this.$contentHol.unbind();this.$givHol.remove();g.each(this,function(n,m){if(!g.isFunction(m)){n=null}})};e.prototype.preloaderDisplay=function(){this.$preloadHol.stop(true,true).fadeIn(200)};e.prototype.preloaderHide=function(){this.$preloadHol.fadeOut(300)};e.prototype.mousePageCoor=function(n){var m={x:n.pageX,y:n.pageY};n=n.originalEvent;if(this.isTouchDev&&n){m.x=n.changedTouches[0].pageX;m.y=n.changedTouches[0].pageY}return m};e.prototype.mouseenterHandler=function(m){if(!m.data._this.sett.testMode){m.data._this.$contentHol.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")}};e.prototype.mousedownHandler=function(m){var n=m.data._this;n.animStop(true);n.stopMoving();n.stopDirectMoving();if(n.isTouchDev){n.$contentHol.unbind("touchmove.lhpGIV",n.mousemoveHandler).bind("touchmove.lhpGIV",{_this:n},n.mousemoveHandler);n.$contentHol.unbind({"touchend.lhpGIV":n.positioning}).bind("touchend.lhpGIV",{_this:n},n.positioning)}else{n.$contentHol.removeClass("lhp_cursor_hand").addClass("lhp_cursor_drag");n.$contentHol.unbind("mousemove.lhpGIV",n.mousemoveHandler).bind("mousemove.lhpGIV",{_this:n},n.mousemoveHandler);n.$contentHol.unbind({"mouseup.lhpGIV":n.positioning}).bind("mouseup.lhpGIV",{_this:n},n.positioning)}n.lastMousePageCoor=n.mousePageCoor(m);m.preventDefault()};e.prototype.mousemoveHandler=function(m){var n=m.data._this;if(n.isTouchDev){n.$contentHol.unbind({"touchend.lhpGIV":n.positioning});n.$contentHol.unbind({"touchend.lhpGIV":n.stopDraggingHandler}).bind("touchend.lhpGIV",{_this:n},n.stopDraggingHandler)}else{n.$contentHol.unbind("mouseup.lhpGIV",n.positioning);n.$contentHol.unbind({"mouseup.lhpGIV":n.stopDraggingHandler}).bind("mouseup.lhpGIV",{_this:n},n.stopDraggingHandler);n.$contentHol.unbind({"mouseleave.lhpGIV":n.stopDraggingHandler}).bind("mouseleave.lhpGIV",{_this:n},n.stopDraggingHandler)}n.dragging(m,"hard");m.preventDefault()};e.prototype.mouseupHandler=function(m){var n=m.data._this;n.$contentHol.unbind("mousemove.lhpGIV",n.mousemoveHandler);n.$contentHol.unbind("mouseup.lhpGIV",n.positioning);if(!n.sett.testMode){n.$contentHol.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")}else{n.$contentHol.css("cursor","default")}};e.prototype.stopDraggingHandler=function(m){var n=m.data._this;n.$contentHol.unbind({"mouseup.lhpGIV":n.stopDraggingHandler});n.$contentHol.unbind({"mouseleave.lhpGIV":n.stopDraggingHandler});n.dragging(m,"inertia")};e.prototype.mousewheelHandler=function(n,q){var p=n.data._this,o=(q>0)?p.sm.nextScale():p.sm.prevScale(),m=p.calculateScale(n,o);p.animStop();p.stopMoving();p.stopDirectMoving();if((q>0&&!p.allow.allowZoom)||(q<0&&!p.allow.allowUnzoom)){return false}p.animSizeAndPos(m.x,m.y,m.w,m.h);n.preventDefault();n.stopPropagation();return false};e.prototype.showCurrentCoor=function(p){var r=p.data._this,m=r.mousePageCoor(p),q=r.$contentHol.position(),n=r.$givHol.offset(),o=r.$content.width()/r.contentFullSize.w;m.x=Math.round((m.x-q.left-n.left)/o);m.y=Math.round((m.y-q.top-n.top)/o);r.$infoBox.css("display","block");r.$infoBox.html("x:"+m.x+" y:"+m.y)};e.prototype.adaptsToContainer=function(){if(this.$content){var m=this.$content.width()/this.contentFullSize.w;m=(m>1)?1:m;this.animStop();this.stopMoving();this.stopDirectMoving();this.setProperties(null,null,m,true)}};e.prototype.beginZooming=function(o){if(this.$content){var s=(o=="Z")?1:-1,q={_this:this},m={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},p=this.$givHol.offset(),n={x:(m.x+p.left),y:(m.y+p.top)},r={data:q,pageX:n.x,pageY:n.y};this.animStop(true);this.stopMoving();this.stopDirectMoving();if(!this.movingIntreval){this.movingIntreval=setInterval(function(v,t,u){return function(){v.zooming(t,u)}}(this,r,s),this.sett.animTime/5)}this.zooming(r,s)}};e.prototype.zooming=function(n,p){var o=(p>0)?this.sm.nextScale():this.sm.prevScale(),m=this.calculateScale(n,o);this.animStop();this.animSizeAndPos(m.x,m.y,m.w,m.h);if(this.sett.fitToViewportShortSide){if(o>=1||m.w<=this.$givHol.width()||m.h<=this.$givHol.height()){this.stopZooming()}}else{if(o>=1||(m.w<=this.$givHol.width()&&m.h<=this.$givHol.height())){this.stopZooming()}}};e.prototype.stopZooming=function(){this.stopMoving()};e.prototype.beginDirectMove=function(m){if(this.$content){this.animStop(true);this.stopMoving();this.sm.setScale(this.$content.width()/this.contentFullSize.w);this.speedX=this.speedY=0;switch(m){case"U":this.speedY=-50000/this.sett.animTime;break;case"D":this.speedY=50000/this.sett.animTime;break;case"L":this.speedX=-50000/this.sett.animTime;break;case"R":this.speedX=50000/this.sett.animTime;break}if(!this.movingDirectIntreval&&(this.speedX||this.speedY)){this.movingDirectIntreval=setInterval(function(n){return function(){n.directMoveWithInertia()}}(this),10)}}};e.prototype.directMoveWithInertia=function(){var n=this.$contentHol.position().left,m=this.$contentHol.position().top,q=Math.ceil(n+this.speedX),o=Math.ceil(m+this.speedY),p;if(!this.movingIntreval){this.movingIntreval=setInterval(function(r){return function(){r.moveWithInertia()}}(this),10)}p=this.getSafeTarget(q,o,this.speedX,this.speedY);this.targetX=Math.round(p.x);this.targetY=Math.round(p.y)};e.prototype.stopDirectMoving=function(){clearInterval(this.movingDirectIntreval);this.movingDirectIntreval=null};e.prototype.dragging=function(r,p){var q=this.sett.draggInertia,n=this.mousePageCoor(r),o=n.x-this.lastMousePageCoor.x,m=n.y-this.lastMousePageCoor.y;if(p=="inertia"&&this.lastDragg){this.draggingWithInertia(this.lastDragg.x*q,this.lastDragg.y*q)}else{this.draggingHard(o,m)}this.lastDragg={x:(Math.abs(o)<5)?0:o,y:(Math.abs(m)<5)?0:m};this.lastMousePageCoor=n};e.prototype.draggingHard=function(n,m){var r=this.$contentHol.position(),q=r.left+n,o=r.top+m,p=this.getSafeTarget(q,o,n,m);this.animStop();this.addTiles();this.$contentHol.css({left:p.x,top:p.y});this.dispatchEventChange()};e.prototype.draggingWithInertia=function(n,m){var q=this.targetX+n,o=this.targetY+m,p;if(!this.movingIntreval){this.movingIntreval=setInterval(function(r){return function(){r.moveWithInertia()}}(this),10);q=this.$contentHol.position().left+n;o=this.$contentHol.position().top+m}p=this.getSafeTarget(q,o,n,m);this.targetX=Math.round(p.x);this.targetY=Math.round(p.y)};e.prototype.getSafeTarget=function(y,x,o,n){var m=this.getLimit(this.sm.getScale()),q=m.xMin,u=m.xMax,z=m.yMin,t=m.yMax,A=this.$givHol.width(),w=this.$givHol.height(),s=A/2,p=w/2,v=this.contentFullSize.w*this.sm.getScale(),r=this.contentFullSize.h*this.sm.getScale();if((n<0)&&(x<z)){x=z}else{if((n>0)&&(x>t)){x=t}}if(r<w){x=p-r/2}if((o<0)&&(y<q)){y=q}else{if((o>0)&&(y>u)){y=u}}if(v<A){y=s-v/2}return{x:y,y:x}};e.prototype.moveWithInertia=function(){var p=this.$contentHol.position(),o=this.sett.dragSmooth,n,m;p.left=Math.ceil(p.left);p.top=Math.ceil(p.top);n=(this.targetX-p.left)/o;m=(this.targetY-p.top)/o;if(Math.abs(n)<1){n=(n>0)?1:-1}if(Math.abs(m)<1){m=(m>0)?1:-1}if(p.left==this.targetX){n=0}if(p.top==this.targetY){m=0}this.$contentHol.css({left:p.left+n,top:p.top+m});if(p.left==this.targetX&&p.top==this.targetY){this.stopDirectMoving();this.stopMoving();this.addTiles()}this.dispatchEventChange()};e.prototype.stopMoving=function(){clearInterval(this.movingIntreval);this.movingIntreval=null};e.prototype.positioning=function(n){var o=n.data._this,m=o.calculatePosInCenter(n);o.animStop();o.stopMoving();o.stopDirectMoving();o.animSizeAndPos(m.x,m.y)};e.prototype.setProperties=function(B,v,p,A){if(this.$content){var q={_this:this},C={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},o=this.$givHol.offset(),t={x:(C.x+o.left),y:(C.y+o.top)},r={data:q,pageX:t.x,pageY:t.y},z=this.$contentHol.position(),s,w,m=z.left,D=z.top,n=this.$content.width(),u=this.$content.height();B=parseFloat(B);v=parseFloat(v);p=parseFloat(p);if(!isNaN(p)){if(p>1){p=1}s=this.calculateScale(r,p);m=s.x;D=s.y;n=s.w;u=s.h}w=n/this.contentFullSize.w;if(!isNaN(B)){m=-(B*w)+C.x}if(!isNaN(v)){D=-(v*w)+C.y}this.animStop();this.stopMoving();this.stopDirectMoving();this.animSizeAndPos(m,D,n,u,A)}};e.prototype.calculatePosInCenter=function(o){var p=this.$contentHol.position(),n=this.$givHol.offset(),t={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},s=this.mousePageCoor(o),u={x:(s.x-n.left),y:(s.y-n.top)},r,q,m,v;r=t.x-u.x;q=t.y-u.y;m=p.left+r;v=p.top+q;return{x:m,y:v,shftX:r,shftY:q}};e.prototype.calculateScale=function(s,r){var p=this.$givHol.offset(),q=this.$content.offset(),v=this.mousePageCoor(s),u,o,m,w,n,t;r=this.getSafeScale(r);this.sm.setScale(r);u=this.$content.width()/this.contentFullSize.w;o={x:(v.x-q.left)/u,y:(v.y-q.top)/u};n=Math.round(this.contentFullSize.w*r);t=Math.round(this.contentFullSize.h*r);m=Math.round(q.left-p.left+o.x*(u-r));w=Math.round(q.top-p.top+o.y*(u-r));return{x:m,y:w,w:n,h:t}};e.prototype.getSafeScale=function(r){var u=(r<=0)?0.00001:r,x=this.$givHol.width(),s=this.$givHol.height(),t=this.contentFullSize.w,o=this.contentFullSize.h,q=t*u,m=o*u,p=x/t,w=s/o,v=x/s,n=q/m;if(this.sett.fitToViewportShortSide){if(q<x||m<s){p=x/this.contentFullSize.w;w=s/this.contentFullSize.h;u=Math.max(p,w);if(!this.sett.contentSizeOver100&&(t<=x||o<=s)){u=1}}}else{if(q<x&&m<s){if(n<=v){u=w}else{u=p}}if(!this.sett.contentSizeOver100&&t<=x&&o<=s){u=1}}return u};e.prototype.getLimit=function(o){var n=-(Math.round(this.contentFullSize.w*o)-this.$givHol.width()),m=-(Math.round(this.contentFullSize.h*o)-this.$givHol.height());return{xMin:n,xMax:0,yMin:m,yMax:0}};e.prototype.getSafeXY=function(w,v,u){var m=this.getLimit(u),B=this.$givHol.width(),t=this.$givHol.height(),p=B/2,n=t/2,s=this.contentFullSize.w,q=this.contentFullSize.h,r=s*u,o=q*u,A=w,z=v;if(r<B){if(w<m.xMin||w>m.xMax){A=p-r/2}}else{if(w<m.xMin){A=m.xMin}else{if(w>m.xMax){A=m.xMax}}}if(o<t){if(v<m.yMin||v>m.yMax){z=n-o/2}}else{if(v<m.yMin){z=m.yMin}else{if(v>m.yMax){z=m.yMax}}}return{x:Math.round(A),y:Math.round(z)}};e.prototype.animSizeAndPos=function(u,r,v,o,t){var q,s,z=function(w){return function(){w.dispatchEventChange()}}(this),m=function(w){return function(){w.addTiles();w.dispatchEventChange()}}(this),n=function(w){return function(){w.setSizeAndPosTiles();w.dispatchEventChange()}}(this),p=function(w){return function(){var x=true;w.isScaled=false;w.setSizeAndPosTiles(x);w.dispatchEventChange()}}(this);if(v!=undefined){s=v/this.contentFullSize.w}else{s=this.$content.width()/this.contentFullSize.w}if(u!=undefined&&r!=undefined){q=this.getSafeXY(u,r,s);if(t){this.$contentHol.css({left:q.x,top:q.y});m()}else{this.$contentHol.animate({left:q.x,top:q.y},{duration:this.sett.animTime,easing:"easeOutCubic",step:z,complete:m})}}if(v!=undefined&&o!=undefined&&(v!=this.$content.width()||o!=this.$content.height())){this.isScaled=true;if(t){this.$content.css({width:v,height:o});n();p()}else{this.removeAllTiles();this.$content.animate({width:v,height:o},{duration:this.sett.animTime,easing:"easeOutCubic",step:n,complete:p})}}};e.prototype.animStop=function(m){if(this.$contentHol&&this.$content){this.$contentHol.stop().clearQueue();this.$content.stop().clearQueue();if(m){this.sm.setScale(this.$content.width()/this.contentFullSize.w)}this.dispatchEventChange()}};e.prototype.dispatchEventChange=function(){var m=this.getCurrentState(),n=g.Event("givChange",m);this.allow=m;this.$mainHolder.trigger(n)};e.prototype.getCurrentState=function(){var n={};if(this.$content){var s=this.$contentHol.position(),p=this.getLimit(this.sm.getScale()),m=this.$content.width(),q=this.$content.height(),o={x:(this.$givHol.width()/2),y:(this.$givHol.height()/2)},r=m/this.contentFullSize.w;n.allowDown=(Math.ceil(s.top)<Math.ceil(p.yMax));n.allowUp=(Math.ceil(s.top)>Math.ceil(p.yMin));n.allowRight=(Math.ceil(s.left)<Math.ceil(p.xMax));n.allowLeft=(Math.ceil(s.left)>Math.ceil(p.xMin));n.allowZoom=(m/this.contentFullSize.w<1);if(this.sett.fitToViewportShortSide){n.allowUnzoom=(m>this.$givHol.width()&&q>this.$givHol.height())}else{n.allowUnzoom=(m>this.$givHol.width()||q>this.$givHol.height())}n.wPropViewpContent=this.$givHol.width()/m;n.hPropViewpContent=this.$givHol.height()/q;n.xPosInCenter=Math.round((-s.left+o.x)/r);n.yPosInCenter=Math.round((-s.top+o.y)/r);n.scale=r;n.isScaled=this.isScaled}return n};e.prototype.addTiles=function(){var p=this.getTileToChange(),n=p.L.length,q,o,r,m;for(o=0;o<n;o++){q=p.L[o];r={};r.$img=g("<img/>");r.url=this.sett.imgDir+q+"."+this.sett.mainImgExt;r.state="loadWait";if(m){r.prev=m}if(p.L[o+1]){r.next=p.L[o+1]}this.tiles[q]=r;m=q}if(n>0){this.preloaderDisplay();this.loadTile(p.L[0])}};e.prototype.loadTile=function(s){var q=this.tiles[s].$img,p=this.tiles[s].url,n=s.split("_"),r=n[0],o=this.sm.getConversionScale(r);this.tiles[s].state="loadStarted";if(!this.isVisible(s)){this.unloadTile(s);return}q.addClass("tile").addClass(s).data("convScale",o).load(function(t,m){return function(){t.tileLoadCompleteHandler(m)}}(this,s)).error(function(t,m){return function(){t.unloadTile(m)}}(this,s)).attr("src",p)};e.prototype.tileLoadCompleteHandler=function(s){var m=this.tiles[s].next,o=this.tiles[s].$img,r=this,q,n,p=(this.$content.width()/this.contentFullSize.w)/o.data("convScale");q=o.clone();q.removeAttr("style");q.removeAttr("class");q.removeAttr("width");q.removeAttr("height");q.css({visibility:"hidden",position:"absolute",left:"-9999px"});this.$contentHol.prepend(q);n={w:q.width()||256,h:q.height()||256};q.remove();this.tiles[s].state="loadComplete";o.css({"z-index":"1",position:"absolute"}).css(this.getCorrectSizeAndPosTiles(s,n,p,true)).data("realSize",n);this.$contentHol.prepend(o);if(m){setTimeout(function(){return function(){r.loadTile(m)}}(),10)}else{this.tilesQueueComplete()}};e.prototype.setSizeAndPosTiles=function(q){var p=this.$content.width()/this.contentFullSize.w,o,n,m;for(m in this.tiles){n=this.tiles[m].$img;o=p/n.data("convScale");n.css(this.getCorrectSizeAndPosTiles(m,n.data("realSize"),o,q))}};e.prototype.getCorrectSizeAndPosTiles=function(o,y,q,m){var t=o.split("_"),n=t[1],v=t[2],p=(m)?Math.ceil(this.tileSize*q):(this.tileSize*q),u=v*p,r=n*p;if(y){var x=(m)?Math.ceil(y.w*q):(y.w*q);var s=(m)?Math.ceil(y.h*q):(y.h*q);return{width:x+"px",height:s+"px",left:u+"px",top:r+"px"}}else{return{width:p+"px",height:p+"px",left:u+"px",top:r+"px"}}};e.prototype.tilesQueueComplete=function(){var m=true,n;for(n in this.tiles){if(this.tiles[n].state!="loadComplete"){m=false;break}}if(m){this.removeInvisibleTiles();this.preloaderHide()}};e.prototype.removeInvisibleTiles=function(){var o=this,m=this.getTileToChange().V,n;this.$contentHol.find(".tile").each(function(){n=g(this).attr("class").split(" ")[1];if(m.indexOf(n)==-1){o.unloadTile(n)}})};e.prototype.removeAllTiles=function(){var n=this,m;this.$contentHol.find(".tile").each(function(){m=g(this).attr("class").split(" ")[1];n.unloadTile(m)})};e.prototype.unloadTile=function(p){var n=this.tiles[p],m=n.next,o=n.prev;n.$img.removeData("convScale");n.$img.removeData("realSize");n.$img.remove();delete this.tiles[p];if(n.state=="loadWait"){if(o){this.tiles[o].next=m}if(m){this.tiles[m].prev=o}else{this.tilesQueueComplete()}}else{if(n.state=="loadStarted"){if(m){this.loadTile(m)}else{this.tilesQueueComplete()}}}};e.prototype.isVisible=function(n){var m=this.getTileToChange().V;return(m.indexOf(n)!=-1)};e.prototype.getTileToChange=function(){var z,r,D=this.sm.getScale(),p=this.sm.getScalePrefix(D),w=this.sm.getConversionScale(p),s=this.tileSize,q=s*D/w,m=this.$contentHol.position(),n=Math.ceil(this.contentFullSize.w*w/s),t=Math.ceil(this.contentFullSize.h*w/s),E,x,C,o="",y="";var B,A;if(this.$contentHol.position().left<0){B=-1*this.$contentHol.position().left}else{B=0}if(this.$contentHol.position().top<0){A=-1*this.$contentHol.position().top}else{A=0}var u={l:B,r:B+this.$givHol.width(),t:A,b:A+this.$givHol.height()};for(r=0;r<t;r++){for(z=0;z<n;z++){x=p+"_"+(r)+"_"+(z);C=","+x;E={l:z*q,r:z*q+q,t:r*q,b:r*q+q};if(((E.l>=u.l&&E.l<=u.r)||(E.r>=u.l&&E.r<=u.r)||(E.l<=u.l&&E.r>=u.r))&&((E.t>=u.t&&E.t<=u.b)||(E.b>=u.t&&E.b<=u.b)||(E.t<=u.t&&E.b>=u.b))){if(!this.tiles[x]){o+=C}y+=C}}}if(o.length>0){o=o.slice(1).split(",")}return{L:o,V:y.slice(1)}};var l=function(){this.step=0.1;this.curr=1};l.prototype.getScale=function(){return this.curr};l.prototype.setScale=function(m){this.curr=m};l.prototype.nextScale=function(){var m=this.curr+this.step;if(m>1){this.curr=1}else{this.curr=m}return this.getScale()};l.prototype.prevScale=function(){var m=this.curr-this.step;if(m<this.step){this.curr=0}else{this.curr=m}return this.getScale()};l.prototype.getScalePrefix=function(m){if(m>0.75){return 0}else{if(m>0.5&&m<=0.75){return 1}else{if(m>0.25&&m<=0.5){return 2}else{if(m>0.125&&m<=0.25){return 3}else{return 4}}}}};l.prototype.getConversionScale=function(m){var n=[1,0.75,0.5,0.25,0.125];return n[m]};var h=function(n,m,o){this.url=n;this.$imgHolder=m;this.callback=o};h.prototype.loadStart=function(){var m=g("<img/>");m.one("load",function(n){return function(o){n.loadComplete(o)}}(this));this.$imgHolder.prepend(m);m.attr("src",this.url)};h.prototype.loadComplete=function(m){if(this.callback){this.callback(g(m.currentTarget))}};h.prototype.dispose=function(){this.callback=null};var a=function(n,o,m){this.sett=n;this.$mainHolder=o;this.isTouchDev=m;this.$navHol=null};a.prototype.navBttCalcSize=function(){var o=27,m=0,p=4,n=this.sett.intNavBttSizeRation;if(n>1){p=Math.ceil(p*n);m=p-4;o+=2*m}return{width:o,paddingHoriziontal:m,paddingVertical:p}};a.prototype.ini=function(){var n=g("<ul />").addClass("ui-widget ui-helper-clearfix"),u=this.$mainHolder,o,r,s,p=this,w=this.navBttCalcSize().width,v=this.navBttCalcSize().paddingVertical,q=this.navBttCalcSize().paddingHoriziontal,m=0,t=[["moveDown","moveStop","ui-icon-carat-1-n","intNavMoveDownBtt"],["moveUp","moveStop","ui-icon-carat-1-s","intNavMoveUpBtt"],["moveRight","moveStop","ui-icon-carat-1-w","intNavMoveRightBtt"],["moveLeft","moveStop","ui-icon-carat-1-e","intNavMoveLeftBtt"],["zoom","zoomStop","ui-icon-zoomin","intNavZoomBtt"],["unzoom","zoomStop","ui-icon-zoomout","intNavUnzoomBtt"],["fitToViewport",null,"ui-icon-stop","intNavFitToViewportBtt"],["fullSize",null,"ui-icon-arrow-4-diag","intNavFullSizeBtt"]];o=g('<div class="lhp_giv_nav"/>').addClass("lhp_giv_nav_pos_"+this.sett.intNavPos);this.$navHol=o;g.each(t,function(y){var z=t[y][0],A=t[y][1],C=t[y][3],B,x;if(p.sett[C]){m+=w;B=g("<li />").addClass("ui-state-default ui-corner-all "+z),x=g("<span />").addClass("ui-icon "+t[y][2]);B.append(x);n.append(B);B.css("padding",v+"px "+q+"px");B.bind("mouseenter.lhpGIV touchstart.lhpGIV",function(){if(!g(this).hasClass("lhp_giv_nav_btt_disab")){g(this).addClass("ui-state-hover")}});B.bind("mouseleave.lhpGIV touchend.lhpGIV",function(){g(this).removeClass("ui-state-hover")});B.bind(((p.isTouchDev)?"touchstart.lhpGIV":"mousedown.lhpGIV"),function(D){return function(E){if(!g(this).hasClass("lhp_giv_nav_btt_disab")){u.lhpGigaImgViewer(D)}E.preventDefault()}}(z));if(A){B.bind(((p.isTouchDev)?"touchend.lhpGIV":"mouseup.lhpGIV"),function(D){return function(E){if(!g(this).hasClass("lhp_giv_nav_btt_disab")){u.lhpGigaImgViewer(D)}E.preventDefault()}}(A))}}});if(this.$navHol.hasClass("lhp_giv_nav_pos_L")||this.$navHol.hasClass("lhp_giv_nav_pos_R")){this.$navHol.css("width",w);this.$navHol.css("margin-top",-m/2)}if(this.$navHol.hasClass("lhp_giv_nav_pos_T")||this.$navHol.hasClass("lhp_giv_nav_pos_B")){this.$navHol.css("margin-left",-m/2)}u.bind("givChange.lhpGIV",function(z){var y="lhp_giv_nav_btt_disab",x="ui-state-hover";if(z.allowDown){o.find(".moveDown").removeClass(y)}else{o.find(".moveDown").removeClass(x).addClass(y)}if(z.allowUp){o.find(".moveUp").removeClass(y)}else{o.find(".moveUp").removeClass(x).addClass(y)}if(z.allowLeft){o.find(".moveLeft").removeClass(y)}else{o.find(".moveLeft").removeClass(x).addClass(y)}if(z.allowRight){o.find(".moveRight").removeClass(y)}else{o.find(".moveRight").removeClass(x).addClass(y)}if(z.allowZoom){o.find(".zoom").removeClass(y);o.find(".fullSize").removeClass(y)}else{o.find(".zoom").removeClass(x).addClass(y);o.find(".fullSize").removeClass(x).addClass(y)}if(z.allowUnzoom){o.find(".unzoom").removeClass(y);o.find(".fitToViewport").removeClass(y)}else{o.find(".unzoom").removeClass(x).addClass(y);o.find(".fitToViewport").removeClass(x).addClass(y)}});if(this.sett.intNavAutoHide){o.css("display","none");u.bind("mouseenter.lhpGIV touchstart.lhpGIV",function(){clearInterval(p.navAutohideInterval);o.fadeIn("fast")});u.bind("mouseleave.lhpGIV touchend.lhpGIV",function(){clearInterval(p.navAutohideInterval);p.navAutohideInterval=setInterval(function(x){return function(){x.stop().clearQueue().fadeOut("fast")}}(o),1000)})}o.append(n);return o};a.prototype.destroy=function(){if(this.$navHol){this.$navHol.find("li").each(function(){g(this).unbind(".lhpGIV")})}};var c=function(o,p,m,n){this.isTouchDev=n;this.sett=o;this.$mainHolder=p;this.$previewImg=m;this.$img=null;this.$mapHol=null;this.$mapWrappHol=null;this.$vr=null;this.lastMousePageCoor={}};c.prototype.ini=function(m){this.$mapHol=g('<div class="lhp_giv_map"/>');this.$mapWrappHol=g('<div class="lhp_giv_map_wrapp_hol"/>');this.$mapHol.append(this.$mapWrappHol);m.prepend(this.$mapHol);this.contentLoader=new h(this.sett.imgDir+this.sett.mapThumbFilename,this.$mapWrappHol,function(o){return function(p){o.start(p)}}(this));var n=this;this.contentLoadStartTimeout=setTimeout(function(){return function(){n.contentLoader.loadStart()}}(),10)};c.prototype.start=function(n){var m=n.width(),o=n.height(),p;this.$img=n;this.$img.css({cursor:"pointer"});this.$mapHol.addClass("lhp_giv_map_pos_"+this.sett.mapPos).css({width:m,height:o});this.$mapWrappHol.addClass("lhp_giv_map_wrapp_hol_"+this.sett.mapPos).css({width:m,height:o});switch(this.sett.mapPos){case"T":case"B":this.$mapHol.css("margin-left",-m/2);break;case"L":case"R":this.$mapHol.css("margin-top",-o/2);break}this.$mapWrappHol.append(this.$img);this.$vr=g('<div class="lhp_giv_map_vr"/>').css({position:"absolute","z-index":2}).appendTo(this.$mapWrappHol);this.vrAddInteractions();this.$mainHolder.bind("givChange.lhpGIV",{_this:this},this.givChangeHandler);p=this.$mainHolder.lhpGigaImgViewer("getCurrentState");p.data={};p.data._this=this;this.givChangeHandler(p)};c.prototype.destroy=function(){clearTimeout(this.contentLoadStartTimeout);this.$vr.unbind(".lhpGIV");this.$mapHol.unbind(".lhpGIV");this.$img.unbind(".lhpGIV");this.contentLoader.dispose();this.contentLoader=null};c.prototype.vrAddInteractions=function(){if(this.isTouchDev){this.$vr.bind("touchstart.lhpGIV",{_this:this},this.mousedownHandler);this.$vr.bind("touchend.lhpGIV",{_this:this},this.mouseupHandler);this.$img.bind("touchstart.lhpGIV",{_this:this},this.mouseclickHandler)}else{this.$vr.bind("mouseenter.lhpGIV",{_this:this},this.mouseenterHandler);this.$vr.bind("mousedown.lhpGIV",{_this:this},this.mousedownHandler);this.$mapHol.bind("mouseup.lhpGIV",{_this:this},this.mouseupHandler);this.$mapHol.bind("mouseleave.lhpGIV",{_this:this},this.mouseupHandler);this.$img.bind("click.lhpGIV",{_this:this},this.mouseclickHandler)}};c.prototype.mouseenterHandler=function(m){m.data._this.$vr.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")};c.prototype.mousedownHandler=function(m){var n=m.data._this;n.$mainHolder.unbind("givChange.lhpGIV",n.givChangeHandler);if(n.isTouchDev){n.$mapHol.unbind("touchmove.lhpGIV",n.mousemoveHandler).bind("touchmove.lhpGIV",{_this:n},n.mousemoveHandler)}else{n.$vr.removeClass("lhp_cursor_hand").addClass("lhp_cursor_drag");n.$mapHol.unbind("mousemove.lhpGIV",n.mousemoveHandler).bind("mousemove.lhpGIV",{_this:n},n.mousemoveHandler)}n.$vr.unbind("mouseenter.lhpGIV",n.mouseenterHandler);n.lastMousePageCoor=n.mousePageCoor(m);n.$vr.addClass("lhp_giv_map_vr_over");m.preventDefault()};c.prototype.mousemoveHandler=function(m){var n=m.data._this;if(n.isTouchDev){n.$mapHol.unbind({"touchend.lhpGIV":n.stopDraggingHandler}).bind("touchend.lhpGIV",{_this:n},n.stopDraggingHandler)}else{n.$mapHol.unbind({"mouseup.lhpGIV":n.stopDraggingHandler}).bind("mouseup.lhpGIV",{_this:n},n.stopDraggingHandler);n.$mapHol.unbind({"mouseleave.lhpGIV":n.stopDraggingHandler}).bind("mouseleave.lhpGIV",{_this:n},n.stopDraggingHandler)}n.dragging(m);m.preventDefault()};c.prototype.mouseupHandler=function(m){var n=m.data._this;n.$mapHol.unbind("touchmove.lhpGIV",n.mousemoveHandler);n.$mapHol.unbind("mousemove.lhpGIV",n.mousemoveHandler);n.$mainHolder.unbind("givChange.lhpGIV",n.givChangeHandler).bind("givChange.lhpGIV",{_this:n},n.givChangeHandler);if(!n.isTouchDev){n.$vr.unbind("mouseenter.lhpGIV",n.mouseenterHandler).bind("mouseenter.lhpGIV",{_this:n},n.mouseenterHandler);n.$vr.removeClass("lhp_cursor_drag").addClass("lhp_cursor_hand")}n.$vr.removeClass("lhp_giv_map_vr_over")};c.prototype.mouseclickHandler=function(p){var r=p.data._this,n=r.mousePageCoor(p),o=r.$mapHol.offset(),m=(n.x-o.left)*r.sett.mainImgWidth/r.$mapWrappHol.width(),q=(n.y-o.top)*r.sett.mainImgHeight/r.$mapWrappHol.height();r.$mainHolder.lhpGigaImgViewer("setPosition",m,q)};c.prototype.dragging=function(s){var n=this.mousePageCoor(s),o=n.x-this.lastMousePageCoor.x,m=n.y-this.lastMousePageCoor.y,t=this.$vr.position(),r=t.left+o,p=t.top+m,q=this.getSafeTarget(r,p,o,m);this.$vr.css({left:q.x,top:q.y});this.lastMousePageCoor=n;this.mainHolderSetPosition(q.x,q.y)};c.prototype.stopDraggingHandler=function(m){var n=m.data._this;n.$mapHol.unbind({"touchend.lhpGIV":n.stopDraggingHandler});n.$mapHol.unbind({"mouseup.lhpGIV":n.stopDraggingHandler});n.$mapHol.unbind({"mouseleave.lhpGIV":n.stopDraggingHandler})};c.prototype.mousePageCoor=function(n){var m={x:n.pageX,y:n.pageY};n=n.originalEvent;if(this.isTouchDev&&n){m.x=n.changedTouches[0].pageX;m.y=n.changedTouches[0].pageY}return m};c.prototype.getSafeTarget=function(r,q,o,n){var p=0,m=0,t=this.$mapWrappHol.width()-this.$vr.width(),s=this.$mapWrappHol.height()-this.$vr.height();if((n<0)&&(q<m)){q=m}else{if((n>0)&&(q>s)){q=s}}if((o<0)&&(r<p)){r=p}else{if((o>0)&&(r>t)){r=t}}return{x:r,y:q}};c.prototype.mainHolderSetPosition=function(o,n){var m=(o+this.$vr.width()/2)*this.sett.mainImgWidth/this.$mapWrappHol.width(),p=(n+this.$vr.height()/2)*this.sett.mainImgHeight/this.$mapWrappHol.height();this.$mainHolder.lhpGigaImgViewer("setPosition",m,p,null,true)};c.prototype.givChangeHandler=function(r){var t=r.data._this,n=t.$mapWrappHol.width(),q=t.$mapWrappHol.height(),s=Math.round(n*((r.wPropViewpContent>1)?1:r.wPropViewpContent)),m=Math.round(q*((r.hPropViewpContent>1)?1:r.hPropViewpContent)),p=Math.round((n/t.sett.mainImgWidth)*r.xPosInCenter-(s/2)),o=Math.round((q/t.sett.mainImgHeight)*r.yPosInCenter-(m/2));t.$vr.css({width:s,height:m,left:p,top:o})};var b=function(r,q,m,o,p,n){this.$mainHolder=r;this.$contentHol=q;this.containerId=m;this.mClass="lhp_giv_hotspot";this.mInnClass="lhp_giv_marker";this.pClass="lhp_giv_popup";this.isTouchDev=o;this.markers=[];this.popups=[];this.currShowPopup=null;this.popupShowAction=p;this.startScale=n};b.prototype.ini=function(){var m=this;g("#"+this.containerId).find("."+this.mClass).each(function(){m.addMarker(g(this).clone(true,true))});this.$mainHolder.bind("givChange.lhpGIV",{_this:this},this.givChangeHandler);if(this.startScale==1){this.positionsMarkers(1)}};b.prototype.destroy=function(){var m;for(m in this.markers){this.markers[m].destroy()}for(m in this.popups){this.popups[m].destroy()}this.$mainHolder=null;this.$contentHol=null;this.markers=null;this.popups=null};b.prototype.addMarker=function(u){var q=0,v=0,t=0,s=0,m,r,n,o;if(u.attr("data-id")){q=u.attr("data-id")}if(u.attr("data-x")){v=parseInt(u.attr("data-x"))}if(u.attr("data-y")){t=parseInt(u.attr("data-y"))}if(u.attr("data-visible-scale")){s=parseFloat(u.attr("data-visible-scale"))}if(u.attr("data-url")){m=u.attr("data-url")}o=u.find("."+this.pClass).remove()[0];this.$contentHol.append(u);r=new j(this,q,v,t,s,m,u);this.markers.push(r);if(o){this.$contentHol.append(o);n=new k(q,g(o),r);n.ini();this.popups.push(n);r.popup=n}r.ini()};b.prototype.givChangeHandler=function(m){var n=m.data._this;if(m.isScaled){n.positionsMarkers(m.scale);n.positionsPopup()}else{n.positionsPopup()}};b.prototype.positionsMarkers=function(o){var n,m;for(n in this.markers){m=this.markers[n];m.positions(o);m.visibility(o)}};b.prototype.positionsPopup=function(){if(this.currShowPopup){this.currShowPopup.positions()}};b.prototype.getLimit=function(){var q=this.$contentHol.position(),n=-q.left,p=n+this.$mainHolder.width(),m=-q.top,o=m+this.$mainHolder.height();return{xMin:n,xMax:p,yMin:m,yMax:o}};b.prototype.showPopup=function(m){if(!this.currShowPopup){this.currShowPopup=m;this.currShowPopup.show();this.currShowPopup.positions();return}if(this.currShowPopup&&this.currShowPopup!=m){this.hidePopup(this.currShowPopup);this.currShowPopup=m;this.currShowPopup.show();this.currShowPopup.positions()}};b.prototype.hidePopup=function(m){if(this.currShowPopup&&this.currShowPopup==m){this.currShowPopup.hide();this.currShowPopup=null}};var j=function(q,s,m,r,p,n,o){this.markers=q;this.id=s;this.x=m;this.y=r;this.visibleScale=p;this.url=n;this.$m=o;this.visible=false;this.popup=null;this.popupClose=null};j.prototype.ini=function(){this.style();this.positions(1);if(this.url){this.addInteractivityUrl()}if(this.popup){this.popupClose=this.popup.addClose();this.addPopupAction()}else{if(this.markers.popupShowAction=="rollover"){this.addPopupActionNull()}}};j.prototype.destroy=function(){this.getInn().unbind(".lhpGIV");if(this.popup){this.popupClose.unbind(".lhpGIV");this.popupClose=null;this.popup=null}this.$m=null;this.markers=null};j.prototype.getInn=function(){return this.$m.find("."+this.markers.mInnClass)};j.prototype.getSize=function(){return{w:this.getInn().width(),h:this.getInn().height()}};j.prototype.getEdges=function(){return this.findEdges()};j.prototype.findEdges=function(){var q=this.getInn().offset(),n=this.markers.$mainHolder.offset(),u=this.markers.$contentHol.position(),x=u.left,p=u.top,v=this.getSize(),o=q.left-x-n.left,m=o+v.w,w=q.top-p-n.top,s=w+v.h;return({L:o,R:m,T:w,B:s})};j.prototype.getLimit=function(){return this.markers.getLimit()};j.prototype.style=function(){var m={position:"absolute","z-index":"2",display:"none"};this.$m.css(m);this.$m.css("height",this.$m.height())};j.prototype.positions=function(n){var m=Math.round(this.x*n),o=Math.round(this.y*n);this.$m.css({left:m,top:o})};j.prototype.visibility=function(m){if(m>=this.visibleScale){if(!this.visible){this.$m.stop(true,true).fadeIn(200)}this.visible=true}else{if(this.visible){this.$m.fadeOut(300)}this.visible=false;this.markers.hidePopup(this.popup)}};j.prototype.addInteractivityUrl=function(){this.getInn().css("cursor","pointer");this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mousedown.lhpGIV"),{_this:this},this.clickHandlerUrl)};j.prototype.clickHandlerUrl=function(m){var n=m.data._this;if(n.url){window.location=n.url}m.stopPropagation()};j.prototype.addPopupAction=function(){if(this.markers.popupShowAction=="click"){this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mousedown.lhpGIV"),{_this:this},this.showPopup);this.getInn().css("cursor","pointer")}else{this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mouseenter.lhpGIV"),{_this:this},this.showPopup)}this.popupClose.bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mousedown.lhpGIV"),{_this:this},this.hidePopup)};j.prototype.addPopupActionNull=function(){this.getInn().bind(((this.markers.isTouchDev)?"touchend.lhpGIV":"mouseenter.lhpGIV"),{_this:this},this.showPopup)};j.prototype.showPopup=function(m){var n=m.data._this;n.markers.showPopup(n.popup);m.stopPropagation()};j.prototype.hidePopup=function(m){var n=m.data._this;n.markers.hidePopup(n.popup);m.stopPropagation()};var k=function(o,n,m){this.id=o;this.$p=n;this.marker=m;this.posHor=this.posHC;this.posVer=this.posVT;this.$closeHolder=null};k.prototype.ini=function(){if(this.$p.hasClass("pos-TL")){this.posHor=this.posHL;this.posVer=this.posVT}else{if(this.$p.hasClass("pos-T")){this.posHor=this.posHC;this.posVer=this.posVT}else{if(this.$p.hasClass("pos-TR")){this.posHor=this.posHR;this.posVer=this.posVT}else{if(this.$p.hasClass("pos-L")){this.posHor=this.posHL;this.posVer=this.posVC}else{if(this.$p.hasClass("pos-R")){this.posHor=this.posHR;this.posVer=this.posVC}else{if(this.$p.hasClass("pos-BL")){this.posHor=this.posHL;this.posVer=this.posVB}else{if(this.$p.hasClass("pos-B")){this.posHor=this.posHC;this.posVer=this.posVB}else{if(this.$p.hasClass("pos-BR")){this.posHor=this.posHR;this.posVer=this.posVB}}}}}}}}this.$p.bind("mousedown.lhpGIV touchmove.lhpMIV touchend.lhpMIV mouseenter.lhpMIV mouseleave.lhpMIV mousewheel.lhpMIV",function(m){m.stopPropagation();return false});this.style();this.positions(1)};k.prototype.destroy=function(){this.$p=null;this.marker=null};k.prototype.style=function(){var m={display:"none",position:"absolute","z-index":"3"};this.$p.css(m);this.$p.css("height",this.$p.height())};k.prototype.addClose=function(){this.$closeHolder=g('<div class="lhp_giv_popup_close"></div>');this.$closeHolder.hover(function(){g(this).css("opacity",0.7)},function(){g(this).css("opacity",1)});this.$p.append(this.$closeHolder);return this.$closeHolder};k.prototype.getSize=function(){return{w:this.$p.width(),h:this.$p.height()}};k.prototype.positions=function(){var n=this.marker.getEdges(),m=this.posHor(n),r=this.posVer(n),p=this.marker.getLimit(),o=this.$p.width(),q=this.$p.height();if(m<p.xMin){m=p.xMin}else{if(m+o>p.xMax){m=p.xMax-o}}if(r<p.yMin){r=p.yMin}else{if(r+q>p.yMax){r=p.yMax-q}}this.$p.css({left:m,top:r})};k.prototype.posVT=function(m){return Math.round(m.T)-this.$p.height()};k.prototype.posVC=function(m){return Math.round(m.T+(m.B-m.T)/2)-this.$p.height()/2};k.prototype.posVB=function(m){return Math.round(m.B)};k.prototype.posHL=function(m){return Math.round(m.L)-this.$p.width()};k.prototype.posHC=function(m){return Math.round(m.L+(m.R-m.L)/2)-this.$p.width()/2};k.prototype.posHR=function(m){return Math.round(m.R)};k.prototype.show=function(){this.$p.fadeIn(300)};k.prototype.hide=function(){this.$p.stop().clearQueue().fadeOut(100)}})(jQuery);